#parse("/velocity/layout/mainLayout.vm")
#@mainLayout()


<link rel="stylesheet" href="/css/reports.css">

<div class="rightbox">
    <div class="content">
        <div class="contentTitle">
            <div class="row phonescrollable">
                <div class="col-9"><h2>Amortization report</h2></div>
            </div>
        </div>

        <br>
        <div style="overflow-x:scroll">
            <table class="table table-hover fixed_header" id="myTable">
                <thead>
                <tr>
                    <th>Investment</th>
                    <th>Date</th>
                    <th>Subtotal</th>
                    <th>% Amortization</th>
                    <th>Amortization</th>
                    <th>Period amortization</th>
                </tr>
                </thead>
                <tbody>
                <tr id="buildings" class="opener">
                    <td>Buildings</td>
                    <td></td>
                    <td>$number.format("currency",$report.calculateBase($report.getBuildings()))</td>
                    <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($report.getBuildings()))%
                    </td>
                    <td>$number.format("currency",$report.calculateAccumulatedAmortization($report.getBuildings()))</td>
                    <td>$number.format("currency",$report.calculatePeriodAmortization($report.getBuildings()))</td>
                </tr>
                    #foreach($bill in $report.getBuildings())
                    <tr data-href="$bill.getUUID()" class="hidden buildings bill">
                        <td>
                            <li>$bill.getConcept()</li>
                        </td>
                        <td>$date.format("MMM dd, yyyy",$bill.getDate())</td>
                        <td>$number.format("currency",$bill.getSubtotal())</td>
                        <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($bill)) %</td>
                        <td>$number.format("currency",$report.calculateAccumulatedAmortization($bill))</td>
                        <td>$number.format("currency",$report.calculatePeriodAmortization($bill))</td>
                    </tr>
                    #end
                <tr id="furniture" class="opener">
                    <td>Furniture and office equipment</td>
                    <td></td>
                    <td>$number.format("currency",$report.calculateBase($report.getOfficeEquipment()))</td>
                    <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($report.getOfficeEquipment()))
                        %
                    </td>
                    <td>$number.format(
                        "currency",$report.calculateAccumulatedAmortization($report.getOfficeEquipment()))</td>
                    <td>$number.format(
                        "currency",$report.calculatePeriodAmortization($report.getOfficeEquipment()))</td>
                </tr>
                    #foreach($bill in $report.getOfficeEquipment())
                    <tr data-href="$bill.getUUID()" class="hidden furniture bill">
                        <td>
                            <li>$bill.getConcept()</li>
                        </td>
                        <td>$date.format("MMM dd, yyyy",$bill.getDate())</td>
                        <td>$number.format("currency",$bill.getSubtotal())</td>
                        <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($bill)) %</td>
                        <td>$number.format("currency",$report.calculateAccumulatedAmortization($bill))</td>
                        <td>$number.format("currency",$report.calculatePeriodAmortization($bill))</td>
                    </tr>
                    #end
                <tr id="transport" class="opener">
                    <td>Transport equipment</td>
                    <td></td>
                    <td>$number.format("currency",$report.calculateBase($report.getTransportEquipment()))</td>
                    <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($report.getTransportEquipment()))
                        %
                    </td>
                    <td>$number.format(
                        "currency",$report.calculateAccumulatedAmortization($report.getTransportEquipment()))</td>
                    <td>$number.format(
                        "currency",$report.calculatePeriodAmortization($report.getTransportEquipment()))</td>
                </tr>
                    #foreach($bill in $report.getTransportEquipment())
                    <tr data-href="$bill.getUUID()" class="hidden transport bill">
                        <td>
                            <li>$bill.getConcept()</li>
                        </td>
                        <td>$date.format("MMM dd, yyyy",$bill.getDate())</td>
                        <td>$number.format("currency",$bill.getSubtotal())</td>
                        <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($bill)) %</td>
                        <td>$number.format("currency",$report.calculateAccumulatedAmortization($bill))</td>
                        <td>$number.format("currency",$report.calculatePeriodAmortization($bill))</td>
                    </tr>
                    #end
                <tr id="computational" class="opener">
                    <td>Computational equipment and accesories</td>
                    <td></td>
                    <td>$number.format("currency",$report.calculateBase($report.getComputationalEquipment()))</td>
                    <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($report.getComputationalEquipment()))
                        %
                    </td>
                    <td>$number.format(
                        "currency",$report.calculateAccumulatedAmortization($report.getComputationalEquipment()))</td>
                    <td>$number.format(
                        "currency",$report.calculatePeriodAmortization($report.getComputationalEquipment()))</td>
                </tr>
                    #foreach($bill in $report.getComputationalEquipment())
                    <tr data-href="$bill.getUUID()" class="hidden computational bill">
                        <td>
                            <li>$bill.getConcept()</li>
                        </td>
                        <td>$date.format("MMM dd, yyyy",$bill.getDate())</td>
                        <td>$number.format("currency",$bill.getSubtotal())</td>
                        <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($bill)) %</td>
                        <td>$number.format("currency",$report.calculateAccumulatedAmortization($bill))</td>
                        <td>$number.format("currency",$report.calculatePeriodAmortization($bill))</td>
                    </tr>
                    #end
                <tr id="models" class="opener">
                    <td>Models and Tools</td>
                    <td></td>
                    <td>$number.format("currency",$report.calculateBase($report.getModelsAndTools()))</td>
                    <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($report.getModelsAndTools()))
                        %
                    </td>
                    <td>$number.format(
                        "currency",$report.calculateAccumulatedAmortization($report.getModelsAndTools()))</td>
                    <td>$number.format("currency",$report.calculatePeriodAmortization($report.getModelsAndTools()))</td>
                </tr>
                    #foreach($bill in $report.getModelsAndTools())
                    <tr data-href="$bill.getUUID()" class="hidden models bill">
                        <td>
                            <li>$bill.getConcept()</li>
                        </td>
                        <td>$date.format("MMM dd, yyyy",$bill.getDate())</td>
                        <td>$number.format("currency",$bill.getSubtotal())</td>
                        <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($bill)) %</td>
                        <td>$number.format("currency",$report.calculateAccumulatedAmortization($bill))</td>
                        <td>$number.format("currency",$report.calculatePeriodAmortization($bill))</td>
                    </tr>
                    #end
                <tr id="telephone" class="opener">
                    <td>Telephone communications</td>
                    <td></td>
                    <td>$number.format("currency",$report.calculateBase($report.getTelephoneCommunications()))</td>
                    <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($report.getTelephoneCommunications()))
                        %
                    </td>
                    <td>$number.format(
                        "currency",$report.calculateAccumulatedAmortization($report.getTelephoneCommunications()))</td>
                    <td>$number.format(
                        "currency",$report.calculatePeriodAmortization($report.getTelephoneCommunications()))</td>
                </tr>
                    #foreach($bill in $report.getTelephoneCommunications())
                    <tr data-href="$bill.getUUID()" class="hidden telephone bill">
                        <td>
                            <li>$bill.getConcept()</li>
                        </td>
                        <td>$date.format("MMM dd, yyyy",$bill.getDate())</td>
                        <td>$number.format("currency",$bill.getSubtotal())</td>
                        <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($bill)) %</td>
                        <td>$number.format("currency",$report.calculateAccumulatedAmortization($bill))</td>
                        <td>$number.format("currency",$report.calculatePeriodAmortization($bill))</td>
                    </tr>
                    #end
                <tr id="satellite" class="opener">
                    <td>Satellite communications</td>
                    <td></td>
                    <td>$number.format("currency",$report.calculateBase($report.getSatelliteCommunications()))</td>
                    <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($report.getSatelliteCommunications()))
                        %
                    </td>
                    <td>$number.format(
                        "currency",$report.calculateAccumulatedAmortization($report.getSatelliteCommunications()))</td>
                    <td>$number.format(
                        "currency",$report.calculatePeriodAmortization($report.getSatelliteCommunications()))</td>
                </tr>
                    #foreach($bill in $report.getSatelliteCommunications())
                    <tr data-href="$bill.getUUID()" class="hidden satellite bill">
                        <td>
                            <li>$bill.getConcept()</li>
                        </td>
                        <td>$date.format("MMM dd, yyyy",$bill.getDate())</td>
                        <td>$number.format("currency",$bill.getSubtotal())</td>
                        <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($bill)) %</td>
                        <td>$number.format("currency",$report.calculateAccumulatedAmortization($bill))</td>
                        <td>$number.format("currency",$report.calculatePeriodAmortization($bill))</td>
                    </tr>
                    #end
                <tr id="other" class="opener">
                    <td>Other machinery and equipment</td>
                    <td></td>
                    <td>$number.format("currency",$report.calculateBase($report.getOtherMachineryAndEquipment()))</td>
                    <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($report.getOtherMachineryAndEquipment()))
                        %
                    </td>
                    <td>$number.format(
                        "currency",$report.calculateAccumulatedAmortization($report.getOtherMachineryAndEquipment()))</td>
                    <td>$number.format(
                        "currency",$report.calculatePeriodAmortization($report.getOtherMachineryAndEquipment()))</td>
                </tr>
                    #foreach($bill in $report.getOtherMachineryAndEquipment())
                    <tr data-href="$bill.getUUID()" class="hidden other bill">
                        <td>
                            <li>$bill.getConcept()</li>
                        </td>
                        <td>$date.format("MMM dd, yyyy",$bill.getDate())</td>
                        <td>$number.format("currency",$bill.getSubtotal())</td>
                        <td>$math.roundTo(2,$report.calculateAccumulatedAmortizationPercentage($bill)) %</td>
                        <td>$number.format("currency",$report.calculateAccumulatedAmortization($bill))</td>
                        <td>$number.format("currency",$report.calculatePeriodAmortization($bill))</td>
                    </tr>
                    #end
                </tbody>
            </table>
        </div>


    </div>
</div>

<div class="leftbox">
    <div class="content" style="margin-bottom:5%">
        <div>
            <h4 class="contentTitle">Amortization period</h4>
            <br>
            <div>
                <form>
                    <div class="row">
                        <div class="col">
                            <p>Period start</p>
                        </div>
                        <div class="col-8">
                            <input class="form-control" type="date" value="2011-08-19" id="pStart" name="periodStart">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p>Period end</p>
                        </div>
                        <div class="col-8">
                            <input class="form-control" type="date" value="2011-08-19" id="pEnd" name="periodEnd">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <button type="submit" value="Submit" class="btn btn-secondary" style="float:right">Submit
                            </button>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>
    <div class="content" style="height:60%; margin-bottom:5%">
        <div>
            <h4 class="contentTitle">Amortization Chart</h4>
        </div>
        <div id="piechart" style="height:90%"></div>
    </div>
</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script>
    google.charts.load('current', {'packages': ['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    var data;
    var options;
    var chart;

    function drawChart() {
        data = google.visualization.arrayToDataTable([
            ['Investment', 'amortization', {role: 'annotation'}, { role: 'style' }],
            #foreach($key in $barChart)
                ['$key',$math.roundTo(2,$barChart.getCount($key)), '$math.roundTo(2,$barChart.getCount($key)) %', 'rgb(121,202,207)'],
            #end
        ]);

        options = {
            title: 'Investments',
            backgroundColor: 'rgb(247,250,252)',
            legend: {position:'none'}
        };

        chart = new google.visualization.BarChart(document.getElementById('piechart'));

        chart.draw(data, options);
    }

    function resize() {
        chart = new google.visualization.BarChart(document.getElementById('piechart'));
        chart.draw(data, options);
    }

    window.onload = resize;
    window.onresize = resize;

    document.getElementsByClassName('overlay')[0].addEventListener('transitionend', function (event) {
        if (event.propertyName !== 'width') return;
        resize();
        setTimeout(function(){ resize()},10);
    });
</script>

<script src="/javascript/reportsControl.js"></script>

<script>
    setPeriodStartDate($report.getPeriodStart().getYear(),$report.getPeriodStart().getMonth(),$report.getPeriodStart().getDate())
    setPeriodEndDate($report.getPeriodEnd().getYear(),$report.getPeriodEnd().getMonth(),$report.getPeriodEnd().getDate())
</script>

#end

