#parse("/velocity/layout.vm")
#mainLayout()
<html>
    <script src="https://unpkg.com/jspdf@1.5.3/dist/jspdf.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.2.13/dist/jspdf.plugin.autotable.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="/javascript/dateFromQuery.js"></script>
    <script src="/javascript/reportsPercentageChange.js"></script>



    <style>
        [data-href] {
            cursor: pointer;
        }
        thead {
            background-color: rgb(0,51,102);
            color:white;
            font-size:117%
        }

        .mainResult{
            border-top:ridge;
            border-bottom:ridge;
            background-color: #f7f7f7;
            font-size:115%;
            font-weight: bold;
        }

        .comboResult{
            font-style: italic;
            text-decoration: underline;
        }

        .field {
            font-size:115%
        }

        .rightbox{
            float:right;
            width:55%;
            margin-right:5%;
            margin-bottom:5%

        }

        .leftbox{
            position:fixed;
            float:left;
            width: 30%;
            margin-right:5%;
            margin-left: 5%;
            height:75%;
            margin-bottom:5%
        }



        @media screen and (max-width: 992px) {
            .rightbox{
                float:none;
                width:90%;
                margin-right:0%;
                margin-left: 5%;

            }
            .leftbox{
                position:static;
                float:none;
                width:90%;

            }
        }

        @media screen and (max-width:650px){
            .phonescrollable{
                overflow-x: scroll;
            }
        }

        .static {
            position: static;
        }
        .fixed{
            width: inherit;
            position: fixed;
        }


        .box {
            width:90%;
            margin:5%;
            float:none;
        }


    </style>

    <body class="main">
        <div class="box">
            <div class = "container content" style="margin-bottom:50px">
                <div class="contentTitle">
                    <div class ="row phonescrollable">
                        <div class="col-9"><h2>Investments report comparison</h2></div>
                        <div class="col-3"><button class="btn btn-outline-secondary" data-toggle="modal" data-target="#myModal">Compare</button></div>
                    </div>
                </div>

                <br>
                <div class="phonescrollable">
                    <table class="table table-hover fixed_header" id="myTable">
                        <thead>
                        <tr>
                            <th>Accounting name</th>
                            <th>Base period 1</th>
                            <th>Base period 2</th>
                            <th>Change</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="field">
                            <td>Buildings</td>
                            <td>$number.format("currency",$report1.getBuildingsBase())</td>
                            <td>$number.format("currency",$report2.getBuildingsBase())</td>
                            <td></td>
                        </tr>
                        <tr class="field">
                            <td>Office equipment</td>
                            <td>$number.format("currency",$report1.getOfficeEquipmentBase())</td>
                            <td>$number.format("currency",$report2.getOfficeEquipmentBase())</td>
                            <td></td>
                        </tr>
                        <tr class="field">
                            <td>Transport equipment</td>
                            <td>$number.format("currency",$report1.getTransportEquipmentBase())</td>
                            <td>$number.format("currency",$report2.getTransportEquipmentBase())</td>
                            <td></td>
                        </tr>
                        <tr class="field">
                            <td>Computational Equipment Base</td>
                            <td>$number.format("currency",$report1.getComputationalEquipmentBase())</td>
                            <td>$number.format("currency",$report2.getComputationalEquipmentBase())</td>
                            <td></td>
                        </tr>
                        <tr class = "field">
                            <td>Models and Tools</td>
                            <td>$number.format("currency",$report1.getModelsAndToolsBase())</td>
                            <td>$number.format("currency",$report2.getModelsAndToolsBase())</td>
                            <td></td>
                        </tr>
                        <tr class="field">
                            <td>Telephone Communications</td>
                            <td>$number.format("currency",$report1.getTelephoneCommunicationsBase())</td>
                            <td>$number.format("currency",$report2.getTelephoneCommunicationsBase())</td>
                            <td></td>
                        </tr>
                        <tr class="field">
                            <td>Satellite Communications</td>
                            <td>$number.format("currency",$report1.getSatelliteCommunicationsBase())</td>
                            <td>$number.format("currency",$report2.getSatelliteCommunicationsBase())</td>
                            <td></td>
                        </tr>
                        <tr class="field">
                            <td>Other Machinery and Equipment</td>
                            <td>$number.format("currency",$report1.getOtherMachineryAndEquipmentBase())</td>
                            <td>$number.format("currency",$report2.getOtherMachineryAndEquipmentBase())</td>
                            <td></td>
                        </tr>
                        <tr class="mainResult">
                            <td>All investments</td>
                            <td>$number.format("currency",$report1.getBase())</td>
                            <td>$number.format("currency",$report2.getBase())</td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="container content" style="height:60%; margin-bottom:5%">
            <div>
                <h4 class="contentTitle">Investments Comparison Chart</h4>
            </div>
            <div id="comparisonChart" style="height:90%"></div>
        </div>
    </body>

    <!-- The Modal -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header" style="background-color: rgb(234,241,247)">
                    <h4 class="modal-title" >Select report periods</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <form id="compareForm" action="/reports/compare/investments">
                        <div class="container">
                            <h6>Report 1</h6>
                            <br>
                            <div class="row">
                                <div class="col">
                                    <p>Period start</p>
                                </div>
                                <div class="col-8">
                                    <input class="form-control" type="date" id="pStart1" value="2011-08-19" name="periodStart">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <p>Period end</p>
                                </div>
                                <div class="col-8">
                                    <input class="form-control" type="date" id="pEnd1" value="2011-08-19" name="periodEnd">
                                </div>
                            </div>
                            <h6>Report 2</h6>
                            <br>
                            <div class="row">
                                <div class="col">
                                    <p>Period start</p>
                                </div>
                                <div class="col-8">
                                    <input class="form-control" type="date" id="pStart2" value="2011-08-19" name="periodStart1">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <p>Period end</p>
                                </div>
                                <div class="col-8">
                                    <input class="form-control" type="date" id="pEnd2" value="2011-08-19" name="periodEnd1">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer" style="background-color: rgb(234,241,247)">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                    <button type="submit" form="compareForm" class="btn btn-success">Compare</button>
                </div>

            </div>
        </div>
    </div>


    <script>
        $(document).ready(function(){
            $('[data-toggle="popover"]').popover();
        });
    </script>

    <script>
        addPercentageChangeToTable();
        dateFromQueryToModal();
    </script>

    <script>
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        var data;
        var options;
        var chart;

        function drawChart() {
            data = google.visualization.arrayToDataTable([
                ['Investment', getFirstPeriodString(), getSecondPeriodString()],
                #foreach($key in $barChart1)
                    ['$key',$barChart1.getCount($key), $barChart2.getCount($key)],
                #end
            ]);

            options = {
                title: 'Investments',
                backgroundColor:'rgb(247,250,252)'
            };

            chart = new google.visualization.BarChart(document.getElementById('comparisonChart'));

            chart.draw(data, options);
        }
        function resize () {
            chart = new google.visualization.BarChart(document.getElementById('comparisonChart'));
            chart.draw(data, options);
        }

        window.onload = resize;
        window.onresize = resize;

        document.getElementsByClassName('overlay')[0].addEventListener('transitionend', function(event){
            if(event.propertyName !== 'width') return;
            resize();
        });
    </script>

    <script>

        function getFirstPeriodString(){
            return getFirstPeriodStart() + " - \n" + getFirstPeriodEnd();
        }

        function getSecondPeriodString(){
            return getSecondPeriodStart() +  " - \n" + getSecondPeriodEnd();
        }

        function getFirstPeriodStart(){
            return getQueryParam("periodStart");
        }

        function getFirstPeriodEnd(){
            return getQueryParam("periodEnd");
        }

        function getSecondPeriodStart(){
            return getQueryParam("periodStart1");
        }
        function getSecondPeriodEnd(){
            return getQueryParam("periodEnd1");
        }

        function getQueryParam(param){
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
    </script>

</html>	
	